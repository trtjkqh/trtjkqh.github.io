<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>供应商信息查询</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-800">
  <div class="max-w-7xl mx-auto p-6">
    <h1 class="text-2xl font-bold mb-4 text-center">供应商信息查询</h1>

    <!-- 查询条件区 -->
    <div class="bg-white p-4 rounded-lg shadow mb-6 flex flex-wrap gap-4 items-center">
      <div>
        <label class="mr-2 font-medium">类别：</label>
        <select id="categorySelect" class="border rounded p-1">
          <option value="">全部类别</option>
        </select>
      </div>
      <div>
        <label class="mr-2 font-medium">是否支持询比价：</label>
        <select id="inquirySelect" class="border rounded p-1">
          <option value="">全部</option>
          <option value="是">是</option>
          <option value="否">否</option>
        </select>
      </div>
      <div>
        <label class="mr-2 font-medium">是否支持打样：</label>
        <select id="sampleSelect" class="border rounded p-1">
          <option value="">全部</option>
          <option value="是">是</option>
          <option value="否">否</option>
        </select>
      </div>
      <button id="searchBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-1 rounded">
        查询
      </button>
    </div>

    <!-- 表格显示区 -->
    <div class="bg-white rounded-lg shadow overflow-x-auto">
      <table id="resultTable" class="min-w-full border border-gray-300 text-sm">
        <thead class="bg-gray-100"></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <script>
    let supplierData = [];

    // 加载数据
    async function loadData() {
      try {
        const res = await fetch("../supplier/data.json");
        supplierData = await res.json();
        initCategoryOptions();
        renderTable(supplierData); // 初始显示所有数据
      } catch (e) {
        console.error("数据加载失败", e);
      }
    }

    // 初始化类别下拉框
    function initCategoryOptions() {
      const categorySelect = document.getElementById("categorySelect");
      const categories = [...new Set(supplierData.map(item => item["类别"]))];
      categories.forEach(cat => {
        if (cat) {
          const opt = document.createElement("option");
          opt.value = cat;
          opt.textContent = cat;
          categorySelect.appendChild(opt);
        }
      });
    }

    // 渲染表格（展示所有字段）
    function renderTable(data) {
      const tableHead = document.querySelector("#resultTable thead");
      const tableBody = document.querySelector("#resultTable tbody");
      tableBody.innerHTML = "";

      if (!data.length) {
        tableHead.innerHTML = "";
        tableBody.innerHTML = `<tr><td class="p-3 text-center text-gray-500">无匹配数据</td></tr>`;
        return;
      }

      // 取第一个对象的所有字段名作为表头
      const headers = Object.keys(data[0]);
      tableHead.innerHTML = `<tr>${headers.map(h => `<th class='border p-2 bg-gray-100 text-left whitespace-nowrap'>${h}</th>`).join("")}</tr>`;

      // 渲染每一行
      data.forEach(item => {
        const row = `<tr>${headers.map(h => `<td class='border p-2 whitespace-nowrap'>${item[h] ?? ""}</td>`).join("")}</tr>`;
        tableBody.innerHTML += row;
      });
    }

    // 查询按钮事件
    document.getElementById("searchBtn").addEventListener("click", () => {
      const category = document.getElementById("categorySelect").value;
      const inquiry = document.getElementById("inquirySelect").value;
      const sample = document.getElementById("sampleSelect").value;

      const filtered = supplierData.filter(item =>
        (!category || item["类别"] === category) &&
        (!inquiry || item["是否支持询比价"] === inquiry) &&
        (!sample || item["是否支持打样"] === sample)
      );

      renderTable(filtered);
    });

    loadData();
  </script>
</body>
</html>
