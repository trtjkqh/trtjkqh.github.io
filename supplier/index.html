<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>供应商管理升级版</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body class="bg-gray-100 font-sans p-4">

<div class="mb-4">
  <!-- 筛选区 -->
  <div class="flex flex-wrap gap-2 items-center">
    <select id="categoryFilter" class="border rounded px-2 py-1">
      <option value="">全部供应品类</option>
      <option value="包装">包装</option>
      <option value="辅料">辅料</option>
    </select>
    <input type="text" id="supplierFilter" placeholder="供应商名称" class="border rounded px-2 py-1 flex-1">
    <button id="exportBtn" class="bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600">导出Excel</button>
  </div>
</div>

<!-- 统计区 -->
<div class="grid grid-cols-4 gap-4 mb-4">
  <div class="bg-white p-4 rounded shadow text-center">
    <div class="text-gray-500">供应商总数</div>
    <div id="totalSuppliers" class="text-xl font-bold">0</div>
  </div>
  <div class="bg-white p-4 rounded shadow text-center">
    <div class="text-gray-500">合作中供应商</div>
    <div id="activeSuppliers" class="text-xl font-bold">0</div>
  </div>
  <div class="bg-white p-4 rounded shadow text-center">
    <div class="text-gray-500">A级供应商</div>
    <div id="aSuppliers" class="text-xl font-bold">0</div>
  </div>
  <div class="bg-white p-4 rounded shadow text-center">
    <div class="text-gray-500">采购总金额</div>
    <div id="totalAmount" class="text-xl font-bold">0</div>
  </div>
</div>

<!-- 表格区 -->
<div class="overflow-x-auto bg-white p-2 rounded shadow">
  <table class="min-w-full table-auto border-collapse border border-gray-200" id="supplierTable">
    <thead>
      <tr class="bg-gray-100">
        <th class="border px-2 py-1">供应品类</th>
        <th class="border px-2 py-1">供应商名称</th>
        <th class="border px-2 py-1">供应商等级</th>
        <th class="border px-2 py-1">合作状态</th>
        <th class="border px-2 py-1">采购金额</th>
        <th class="border px-2 py-1">其他字段1</th>
        <th class="border px-2 py-1">其他字段2</th>
        <!-- 可根据 tz/data.json 增加全部字段 -->
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>
</div>

<script>
let supplierData = [];

// 加载数据
async function loadData() {
  const res = await fetch('tz/data.json');
  supplierData = await res.json();
  renderTable();
  updateStats();
}

// 渲染表格
function renderTable() {
  const category = document.getElementById('categoryFilter').value;
  const supplier = document.getElementById('supplierFilter').value.trim().toLowerCase();
  const tbody = document.getElementById('tableBody');
  tbody.innerHTML = '';

  const filtered = supplierData.filter(item => {
    const matchCategory = category ? item['供应品类'] === category : ['包装','辅料'].includes(item['供应品类']);
    const matchSupplier = supplier ? item['供应商名称'].toLowerCase().includes(supplier) : true;
    return matchCategory && matchSupplier;
  });

  filtered.forEach(item => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td class="border px-2 py-1">${item['供应品类'] || ''}</td>
      <td class="border px-2 py-1">${item['供应商名称'] || ''}</td>
      <td class="border px-2 py-1">${item['供应商等级'] || ''}</td>
      <td class="border px-2 py-1">${item['合作状态'] || ''}</td>
      <td class="border px-2 py-1">${item['采购金额'] || 0}</td>
      <td class="border px-2 py-1">${item['其他字段1'] || ''}</td>
      <td class="border px-2 py-1">${item['其他字段2'] || ''}</td>
    `;
    tbody.appendChild(tr);
  });

  updateStats(filtered);
}

// 更新统计
function updateStats(filteredData) {
  const data = filteredData || supplierData.filter(item => ['包装','辅料'].includes(item['供应品类']));
  document.getElementById('totalSuppliers').textContent = data.length;
  document.getElementById('activeSuppliers').textContent = data.filter(d => d['合作状态'] === '合作中').length;
  document.getElementById('aSuppliers').textContent = data.filter(d => d['供应商等级'] === 'A').length;
  const total = data.reduce((sum, d) => sum + (Number(d['采购金额']) || 0), 0);
  document.getElementById('totalAmount').textContent = total.toFixed(2);
}

// Excel 导出
function exportExcel() {
  const table = document.getElementById('supplierTable');
  const wb = XLSX.utils.table_to_book(table, {sheet:"Sheet1"});
  XLSX.writeFile(wb, '供应商数据.xlsx');
}

// 事件绑定
document.getElementById('categoryFilter').addEventListener('change', renderTable);
document.getElementById('supplierFilter').addEventListener('input', renderTable);
document.getElementById('exportBtn').addEventListener('click', exportExcel);

// 初始化
loadData();
</script>
</body>
</html>
