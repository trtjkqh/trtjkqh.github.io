<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>供应商信息与采购统计</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background-color: #f9fafb;
      font-family: 'Microsoft YaHei', sans-serif;
    }
    th {
      background-color: #e5e7eb;
      font-weight: 600;
    }
    tr:hover {
      background-color: #f1f5f9;
    }
  </style>
</head>
<body class="p-8">
  <h1 class="text-2xl font-bold mb-6 text-gray-800">供应商信息与采购统计</h1>

  <div class="overflow-x-auto shadow-lg rounded-2xl bg-white p-4">
    <table class="min-w-full text-sm text-gray-700 border border-gray-200 rounded-lg">
      <thead>
        <tr>
          <th class="px-4 py-2 border">序号</th>
          <th class="px-4 py-2 border">供应商名称</th>
          <th class="px-4 py-2 border">联系人</th>
          <th class="px-4 py-2 border">联系方式</th>
          <th class="px-4 py-2 border">地址</th>
          <th class="px-4 py-2 border text-right">累计采购金额（元）</th>
        </tr>
      </thead>
      <tbody id="supplierBody"></tbody>
    </table>
  </div>

  <p id="totalAmount" class="mt-6 text-gray-700 font-semibold"></p>

  <script>
    async function loadSupplierData() {
      try {
        // 同时加载 supplier/data.json 和 tz/data.json
        const [supplierRes, tzRes] = await Promise.all([
          fetch('data.json'),       // supplier/data.json
          fetch('../tz/data.json')  // tz/data.json
        ]);

        if (!supplierRes.ok || !tzRes.ok) throw new Error('数据加载失败');

        const supplierData = await supplierRes.json();
        const tzData = await tzRes.json();

        // 计算每个供应商的累计采购金额
        const supplierAmounts = {};
        tzData.forEach(item => {
          const name = item['供应商名称'];
          const amount = parseFloat(item['金额'] || 0);
          if (name) {
            supplierAmounts[name] = (supplierAmounts[name] || 0) + amount;
          }
        });

        // 构建表格内容
        const tbody = document.getElementById('supplierBody');
        tbody.innerHTML = '';
        let totalAll = 0;

        supplierData.forEach((supplier, index) => {
          const name = supplier['供应商名称'];
          const amount = supplierAmounts[name] || 0;
          totalAll += amount;

          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td class="border px-4 py-2 text-center">${index + 1}</td>
            <td class="border px-4 py-2">${name}</td>
            <td class="border px-4 py-2">${supplier['联系人'] || '-'}</td>
            <td class="border px-4 py-2">${supplier['联系方式'] || '-'}</td>
            <td class="border px-4 py-2">${supplier['地址'] || '-'}</td>
            <td class="border px-4 py-2 text-right">${amount.toFixed(2)}</td>
          `;
          tbody.appendChild(tr);
        });

        document.getElementById('totalAmount').textContent =
          `全部供应商累计采购金额：${totalAll.toFixed(2)} 元`;

      } catch (error) {
        console.error('加载失败：', error);
        document.getElementById('supplierBody').innerHTML =
          `<tr><td colspan="6" class="text-center text-red-500 py-4">数据加载失败，请检查路径或文件格式</td></tr>`;
      }
    }

    loadSupplierData();
  </script>
</body>
</html>
