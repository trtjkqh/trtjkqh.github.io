<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BOM 查询系统</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 min-h-screen font-sans">

  <!-- 页头 -->
  <header class="bg-gradient-to-r from-red-600 to-red-400 text-white py-6 shadow flex flex-col items-center justify-center">
    <img src="/assets/img/trtlogo.png" alt="LOGO" class="h-16 w-auto mb-2 object-contain">
    <h1 class="text-3xl font-bold tracking-wide">产品 BOM 查询系统</h1>
  </header>

  <!-- 主体 -->
  <main class="max-w-7xl mx-auto mt-10 p-6 bg-white rounded-2xl shadow-xl">

    <!-- 查询区 -->
    <div class="flex flex-col sm:flex-row gap-4 items-center mb-6">
      <input id="search" type="text" placeholder="🔍 输入关键词（产品名、项目号、物料名等）..." 
             class="flex-1 border border-gray-300 rounded-lg px-4 py-2 text-gray-700 focus:outline-none focus:ring-2 focus:ring-red-400" />
      <button id="searchBtn" 
              class="bg-red-500 hover:bg-red-600 text-white px-6 py-2 rounded-lg shadow transition transform hover:scale-105">
        查询
      </button>
    </div>

    <!-- 表格区 -->
    <div class="overflow-x-auto rounded-lg border border-gray-200">
      <table class="min-w-full text-sm text-gray-700">
        <thead class="bg-gray-100 text-gray-800">
          <tr>
            <th class="py-3 px-3 border-b">产品项目号</th>
            <th class="py-3 px-3 border-b">产品名称</th>
            <th class="py-3 px-3 border-b">规格</th>
            <th class="py-3 px-3 border-b">品牌</th>
            <th class="py-3 px-3 border-b">系列</th>
            <th class="py-3 px-3 border-b">物料项目号</th>
            <th class="py-3 px-3 border-b">物料名称</th>
            <th class="py-3 px-3 border-b">数量</th>
          </tr>
        </thead>
        <tbody id="tableBody">
          <tr>
            <td colspan="8" class="text-center text-gray-400 py-6">⏳ 数据加载中...</td>
          </tr>
        </tbody>
        <tfoot class="bg-gray-50 font-semibold text-gray-700">
          <tr>
            <td colspan="7" class="text-right py-2 px-3 border-t">数量汇总：</td>
            <td id="totalQty" class="text-right py-2 px-3 border-t">0</td>
          </tr>
        </tfoot>
      </table>
    </div>
  </main>

  <!-- 页脚 -->
  <footer class="text-center text-gray-400 text-sm py-6">
    © 2025 TRT 数据系统 | 技术支持：王维
  </footer>

  <!-- JS -->
  <script>
    async function searchData() {
      const query = document.getElementById('search').value.trim();
      const tableBody = document.getElementById('tableBody');
      const totalQty = document.getElementById('totalQty');
      tableBody.innerHTML = "<tr><td colspan='8' class='text-center text-gray-400 py-6'>⏳ 数据加载中...</td></tr>";
      totalQty.textContent = "0";

      try {
        const response = await fetch('data.json');
        const data = await response.json();
        const results = data.filter(item =>
          Object.values(item).some(v => String(v).includes(query))
        );

        if (results.length === 0) {
          tableBody.innerHTML = "<tr><td colspan='8' class='text-center text-gray-400 py-6'>未找到匹配项</td></tr>";
          return;
        }

        // 计算汇总数量
        const sum = results.reduce((acc, cur) => acc + Number(cur.数量 || 0), 0);
        totalQty.textContent = sum;

        // 渲染表格
        tableBody.innerHTML = results.map(r => `
          <tr class="border-b hover:bg-red-50 transition">
            <td class="py-2 px-3">${r.产品项目号}</td>
            <td class="py-2 px-3">${r.产品名称}</td>
            <td class="py-2 px-3">${r.规格}</td>
            <td class="py-2 px-3">${r.品牌}</td>
            <td class="py-2 px-3">${r.系列}</td>
            <td class="py-2 px-3">${r.物料项目号}</td>
            <td class="py-2 px-3">${r.物料名称}</td>
            <td class="py-2 px-3 text-right">${r.数量}</td>
          </tr>
        `).join('');
      } catch (e) {
        tableBody.innerHTML = "<tr><td colspan='8' class='text-center text-red-500 py-6'>❌ 数据加载失败</td></tr>";
        console.error(e);
      }
    }

    // 按钮事件绑定
    document.getElementById('searchBtn').addEventListener('click', searchData);
    window.addEventListener('load', searchData);
  </script>
</body>
</html>
