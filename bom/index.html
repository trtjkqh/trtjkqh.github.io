<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>产品BOM查询</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .fade-in { animation: fadeIn 0.4s ease-in; }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(5px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .parent-row { background-color: #f1f5f9; font-weight: bold; cursor: pointer; }
    .child-row { background-color: #fff; }
    .hidden { display: none; }
  </style>
</head>
<body class="bg-gray-100 min-h-screen p-4">
  <div class="max-w-6xl mx-auto bg-white p-6 rounded-2xl shadow fade-in">

    <!-- 搜索栏 -->
    <h2 class="text-2xl font-bold mb-4 text-gray-800">产品BOM查询</h2>
    <div class="flex flex-wrap gap-2 mb-4">
      <input id="searchName" type="text" placeholder="按品名模糊搜索"
             class="border border-gray-300 rounded px-3 py-2 flex-1 min-w-[180px]">
      <input id="searchProject" type="text" placeholder="按项目号精准搜索"
             class="border border-gray-300 rounded px-3 py-2 flex-1 min-w-[180px]">
      <button id="searchBtn" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">查询</button>
      <button id="resetBtn" class="bg-gray-300 text-gray-800 px-4 py-2 rounded hover:bg-gray-400">重置</button>
    </div>

    <!-- 结果表格 -->
    <div id="resultArea" class="hidden overflow-x-auto">
      <table class="min-w-full border border-gray-300">
        <thead class="bg-gray-200">
          <tr>
            <th class="border p-2">项目号</th>
            <th class="border p-2">品名</th>
            <th class="border p-2">规格</th>
            <th class="border p-2">零售价</th>
            <th class="border p-2">物料项目号</th>
            <th class="border p-2">物料名称</th>
            <th class="border p-2">数量</th>
            <th class="border p-2">计量单位</th>
          </tr>
        </thead>
        <tbody id="resultTable" class="text-sm"></tbody>
      </table>
    </div>

  </div>

  <script>
    let bomData = [];

    // 页面初始化加载JSON数据
    fetch('bom_data.json')
      .then(res => res.json())
      .then(data => bomData = data)
      .catch(err => console.error('数据加载失败:', err));

    const searchBtn = document.getElementById('searchBtn');
    const resetBtn = document.getElementById('resetBtn');
    const resultArea = document.getElementById('resultArea');
    const resultTable = document.getElementById('resultTable');

    // 查询按钮点击
    searchBtn.addEventListener('click', () => {
      const name = document.getElementById('searchName').value.trim();
      const project = document.getElementById('searchProject').value.trim();

      if (!name && !project) {
        resultArea.classList.add('hidden');
        return;
      }

      // 模糊匹配品名，精准匹配项目号
      let filtered = bomData.filter(item =>
        (!name || item.品名.includes(name)) &&
        (!project || item.项目号 === project)
      );

      // 分组：按项目号
      const grouped = {};
      filtered.forEach(item => {
        if (!grouped[item.项目号]) grouped[item.项目号] = [];
        grouped[item.项目号].push(item);
      });

      // 清空旧结果
      resultTable.innerHTML = '';

      Object.keys(grouped).forEach(project => {
        const groupItems = grouped[project];
        const parent = groupItems[0];

        // 父项行
        const parentRow = document.createElement('tr');
        parentRow.className = 'parent-row';
        parentRow.innerHTML = `
          <td class="border p-2">${parent.项目号}</td>
          <td class="border p-2">${parent.品名}</td>
          <td class="border p-2">${parent.规格}</td>
          <td class="border p-2">${parent.零售价}</td>
          <td colspan="4" class="border p-2 text-gray-500 text-sm">点击展开物料明细</td>
        `;
        resultTable.appendChild(parentRow);

        // 子项行
        groupItems.forEach(child => {
          const childRow = document.createElement('tr');
          childRow.className = 'child-row hidden';
          childRow.innerHTML = `
            <td colspan="4" class="border p-2"></td>
            <td class="border p-2">${child.物料项目号}</td>
            <td class="border p-2">${child.物料名称}</td>
            <td class="border p-2">${child.数量}</td>
            <td class="border p-2">${child.计量单位}</td>
          `;
          resultTable.appendChild(childRow);
        });

        // 点击展开/收起
        parentRow.addEventListener('click', () => {
          groupItems.forEach((_, i) => {
            const childRow = resultTable.children[
              Array.from(resultTable.children).indexOf(parentRow) + 1 + i
            ];
            childRow.classList.toggle('hidden');
          });
        });
      });

      resultArea.classList.remove('hidden');
    });

    // 重置按钮
    resetBtn.addEventListener('click', () => {
      document.getElementById('searchName').value = '';
      document.getElementById('searchProject').value = '';
      resultArea.classList.add('hidden');
    });
  </script>
</body>
</html>
