<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>åº“å­˜æŸ¥è¯¢</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  @keyframes fadeIn { from { opacity:0; transform:translateY(10px);} to {opacity:1; transform:translateY(0);} }
  .fade-in { animation: fadeIn 0.4s ease-in; }
  table th { position: sticky; top: 0; background-color: white; z-index: 10; }
</style>
</head>

<body class="bg-gray-50 font-sans text-gray-800">

<div id="mainContent" class="transition-opacity duration-500">

  <!-- æŸ¥è¯¢åŒºåŸŸ -->
  <div class="max-w-7xl mx-auto bg-white shadow rounded-xl p-6 mb-6 flex flex-wrap gap-3 items-center fade-in">
    <span class="text-gray-500 text-sm mr-4">æ•°æ®åŸºäº2025å¹´10æœˆ</span>

    <select id="warehouse" class="border border-gray-300 rounded-lg p-2">
      <option value="">å…¨éƒ¨ä»“åº“</option>
      <option>åŒ…æåº“</option>
      <option>1å·åº“</option>
      <option>2å·åº“</option>
      <option>5å·åº“</option>
      <option>åŒ…æåº“-D</option>
    </select>

    <input id="itemId" type="number" placeholder="ç‰©æ–™é¡¹ç›®å·ï¼ˆç²¾å‡†ï¼‰" class="border border-gray-300 rounded-lg p-2 flex-1" />
    <input id="itemName" type="text" placeholder="ç‰©æ–™åç§°ï¼ˆæ¨¡ç³Šï¼‰" class="border border-gray-300 rounded-lg p-2 flex-1" />

    <button id="searchBtn" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition shadow">æŸ¥è¯¢</button>
    <button id="resetBtn" class="bg-gray-200 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-300 transition shadow">é‡ç½®</button>
  </div>

  <!-- é»˜è®¤ä¸‰å¼ å¡ç‰‡ -->
  <section id="contentArea" class="flex-1 bg-gray-50 flex items-center justify-center overflow-auto">
    <div class="flex flex-wrap justify-center gap-8 mt-10">
      <div class="card opacity-0 fade-in bg-red-50 rounded-2xl shadow-lg p-6 w-60 flex flex-col items-center">
        <div class="text-5xl mb-3">ğŸ“¦</div>
        <div class="text-red-600 font-bold text-lg">ä¿éšœä¾›åº”</div>
        <div class="text-gray-700 text-sm mt-2 text-center">ç¡®ä¿ç‰©æ–™ç¨³å®šä¾›åº”ï¼Œæ»¡è¶³ç”Ÿäº§éœ€æ±‚</div>
      </div>
      <div class="card opacity-0 fade-in delay-1 bg-red-50 rounded-2xl shadow-lg p-6 w-60 flex flex-col items-center">
        <div class="text-5xl mb-3">ğŸ’°</div>
        <div class="text-red-600 font-bold text-lg">æ§åˆ¶æˆæœ¬</div>
        <div class="text-gray-700 text-sm mt-2 text-center">åœ¨ä¿è¯è´¨é‡å‰æä¸‹ï¼Œé™ä½é‡‡è´­æˆæœ¬</div>
      </div>
      <div class="card opacity-0 fade-in delay-2 bg-red-50 rounded-2xl shadow-lg p-6 w-60 flex flex-col items-center">
        <div class="text-5xl mb-3">âœ…</div>
        <div class="text-red-600 font-bold text-lg">ä¿è¯è´¨é‡</div>
        <div class="text-gray-700 text-sm mt-2 text-center">ä¸¥æ ¼æŠŠæ§é‡‡è´­ç‰©æ–™è´¨é‡ï¼Œé™ä½é£é™©</div>
      </div>
    </div>
  </section>

  <!-- æ±‡æ€»åŒº -->
  <div id="summary" class="max-w-7xl mx-auto hidden mb-4 flex gap-4 fade-in">
    <div class="flex-1 bg-red-50 border border-red-200 rounded-lg p-4 font-semibold text-red-700 text-center shadow">
      å…±æŸ¥è¯¢åˆ°ï¼š<span id="count"></span> æ¡
    </div>
    <div class="flex-1 bg-green-50 border border-green-200 rounded-lg p-4 font-semibold text-green-700 text-center shadow">
      åˆè®¡é‡‘é¢ï¼š<span id="total"></span> å…ƒ
    </div>
  </div>

  <!-- æŸ¥è¯¢ç»“æœ -->
  <div id="loading" class="text-center text-red-600 font-medium my-6 fade-in">â³ æ•°æ®åŠ è½½ä¸­...</div>
  <div id="result" class="max-w-7xl mx-auto overflow-x-auto fade-in"></div>

</div>

<script>
let data = [];
let tzData = [];

async function loadData() {
  const res = await fetch('data.json');
  data = await res.json();

  try {
    const tzRes = await fetch('../tz/data.json');
    tzData = await tzRes.json();
  } catch {
    tzData = [];
  }

  document.getElementById("loading").style.display = "none";
}

function renderTable(filtered) {
  const resultArea = document.getElementById('result');
  const summary = document.getElementById('summary');
  const countEl = document.getElementById('count');
  const totalEl = document.getElementById('total');

  let totalAmount = 0;
  let tableHTML = `
    <table class="w-full text-sm text-center border border-gray-200 rounded-lg shadow-sm">
      <thead class="bg-gray-100 font-semibold sticky top-0">
        <tr>
          <th class="p-2 border-b">åºå·</th>
          <th class="p-2 border-b">æ‰€åœ¨åº“</th>
          <th class="p-2 border-b">ç‰©æ–™é¡¹ç›®å·</th>
          <th class="p-2 border-b">ç‰©æ–™åç§°</th>
          <th class="p-2 border-b">è¯´æ˜</th>
          <th class="p-2 border-b">è®¡é‡å•ä½</th>
          <th class="p-2 border-b">æ•°é‡</th>
          <th class="p-2 border-b">é‡‡è´­å•ä»·</th>
          <th class="p-2 border-b">é‡‘é¢</th>
        </tr>
      </thead>
      <tbody>
  `;

  if(filtered.length === 0){
    tableHTML += `<tr><td colspan="9" class="p-4 text-gray-500">æœªæ‰¾åˆ°åŒ¹é…çš„æ•°æ®</td></tr>`;
  } else {
    filtered.forEach((item,index)=>{
      let price = item['é‡‡è´­å•ä»·'];
      let amount = item['é‡‘é¢'];

      if((!price || !amount) && tzData.length > 0){
        const match = tzData.find(t=>t['ç‰©æ–™é¡¹ç›®å·']==item['ç‰©æ–™é¡¹ç›®å·']);
        if(match){
          price = match['é‡‡è´­å•ä»·'] || price;
          amount = item['æ•°é‡']*price;
        }
      }

      totalAmount += Number(amount) || 0;

      tableHTML += `
        <tr class="${index%2===0?'bg-gray-50':'bg-white'} hover:bg-red-50 transition">
          <td class="p-2 border-b">${index+1}</td>
          <td class="p-2 border-b">${item['æ‰€åœ¨åº“']}</td>
          <td class="p-2 border-b">${item['ç‰©æ–™é¡¹ç›®å·']}</td>
          <td class="p-2 border-b">${item['ç‰©æ–™åç§°']}</td>
          <td class="p-2 border-b">${item['è¯´æ˜']||''}</td>
          <td class="p-2 border-b">${item['è®¡é‡å•ä½']}</td>
          <td class="p-2 border-b bg-yellow-100 font-semibold">${item['æ•°é‡']}</td>
          <td class="p-2 border-b">${price??''}</td>
          <td class="p-2 border-b text-red-600 font-semibold">${amount??''}</td>
        </tr>
      `;
    });
  }

  tableHTML += `</tbody></table>`;
  resultArea.innerHTML = tableHTML;

  if(filtered.length>0){
    summary.classList.remove('hidden');
    countEl.textContent = filtered.length;
    totalEl.textContent = totalAmount.toFixed(2);
  } else {
    summary.classList.add('hidden');
  }
}

document.getElementById('searchBtn').addEventListener('click',()=>{
  const warehouse = document.getElementById('warehouse').value.trim();
  const itemId = document.getElementById('itemId').value.trim();
  const itemName = document.getElementById('itemName').value.trim();

  const filtered = data.filter(item=>(
    (!warehouse || item['æ‰€åœ¨åº“']===warehouse) &&
    (!itemId || String(item['ç‰©æ–™é¡¹ç›®å·'])===itemId) &&
    (!itemName || item['ç‰©æ–™åç§°'].includes(itemName))
  ));

  renderTable(filtered);
});

document.getElementById('resetBtn').addEventListener('click',()=>{
  document.getElementById('warehouse').value='';
  document.getElementById('itemId').value='';
  document.getElementById('itemName').value='';
  document.getElementById('result').innerHTML='';
  document.getElementById('summary').classList.add('hidden');
});

loadData();
</script>

</body>
</html>
