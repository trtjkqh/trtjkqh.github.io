<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ¯æ—¥å¾…åŠ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
</head>
<body class="bg-gray-50 text-gray-800 min-h-screen">

  <header class="text-center py-6 bg-white shadow">
    <h1 class="text-3xl font-bold mb-2">æ¯æ—¥å¾…åŠ</h1>
    <p id="currentDate" class="text-gray-500">ğŸ“… <script>document.write(new Date().toLocaleDateString());</script></p>
  </header>

  <!-- åˆåŒæ¿å— -->
  <section id="contract-section" class="max-w-6xl mx-auto bg-white rounded-2xl shadow p-6 mt-8">
    <h2 class="text-2xl font-semibold mb-4">ğŸ“„ åˆåŒ</h2>
    <div class="flex flex-wrap items-center justify-between mb-4 gap-2">
      <div class="flex gap-2">
        <button class="bg-blue-500 text-white px-3 py-1 rounded">æ–°å¢åˆåŒ</button>
        <button class="bg-red-500 text-white px-3 py-1 rounded">åˆ é™¤é€‰ä¸­</button>
      </div>
      <input type="text" placeholder="æœç´¢ç‰©æ–™ / ä¾›åº”å•† / è¿›å±•..." class="border px-3 py-1 rounded w-64">
    </div>
    <div class="overflow-x-auto">
      <table class="min-w-full border text-sm">
        <thead class="bg-gray-100 text-gray-700">
          <tr>
            <th class="border px-2 py-1"><input type="checkbox"></th>
            <th class="border px-2 py-1">åºå·</th>
            <th class="border px-2 py-1">ç‰©æ–™å</th>
            <th class="border px-2 py-1">ä¾›åº”å•†</th>
            <th class="border px-2 py-1">3æ–¹æ¯”ä»·</th>
            <th class="border px-2 py-1">å¤‡æ³¨</th>
            <th class="border px-2 py-1">è¿›å±•</th>
            <th class="border px-2 py-1">æ“ä½œ</th>
          </tr>
        </thead>
        <tbody id="contract-table-body"></tbody>
      </table>
    </div>
  </section>

  <!-- ç‰©æ–™è·Ÿè¸ª -->
  <section id="transit-section" class="max-w-6xl mx-auto bg-white rounded-2xl shadow p-6 mt-8">
    <h2 class="text-2xl font-semibold mb-4">ğŸšš ç‰©æ–™è·Ÿè¸ª</h2>
    <div class="flex flex-wrap items-center justify-between mb-4 gap-2">
      <div class="flex gap-2">
        <button class="bg-blue-500 text-white px-3 py-1 rounded">æ–°å¢ç‰©æ–™</button>
        <button class="bg-red-500 text-white px-3 py-1 rounded">åˆ é™¤é€‰ä¸­</button>
      </div>
      <input type="text" placeholder="æœç´¢ç‰©æ–™ / ä¾›åº”å•† / æ—¥æœŸ..." class="border px-3 py-1 rounded w-64">
    </div>
    <div class="overflow-x-auto">
      <table class="min-w-full border text-sm">
        <thead class="bg-gray-100 text-gray-700">
          <tr>
            <th class="border px-2 py-1"><input type="checkbox"></th>
            <th class="border px-2 py-1">åºå·</th>
            <th class="border px-2 py-1">ç‰©æ–™å</th>
            <th class="border px-2 py-1">ä¾›åº”å•†</th>
            <th class="border px-2 py-1">å¤‡æ³¨</th>
            <th class="border px-2 py-1">å‘è´§æ—¥</th>
            <th class="border px-2 py-1">åˆ°è¾¾æ—¥</th>
            <th class="border px-2 py-1">æ“ä½œ</th>
          </tr>
        </thead>
        <tbody id="transit-table-body"></tbody>
      </table>
    </div>
  </section>

  <!-- æ‰“æ ·æ¿å— -->
  <section id="sample-section" class="max-w-6xl mx-auto bg-white rounded-2xl shadow p-6 mt-8">
    <h2 class="text-2xl font-semibold mb-4">ğŸ§ª æ‰“æ ·</h2>
    <div class="flex flex-wrap items-center justify-between mb-4 gap-2">
      <div class="flex gap-2">
        <button class="bg-blue-500 text-white px-3 py-1 rounded">æ–°å¢æ‰“æ ·</button>
        <button class="bg-red-500 text-white px-3 py-1 rounded">åˆ é™¤é€‰ä¸­</button>
      </div>
      <input type="text" placeholder="æœç´¢ç‰©æ–™ / ä¾›åº”å•† / å‡ºæ ·æ—¥..." class="border px-3 py-1 rounded w-64">
    </div>
    <div class="overflow-x-auto">
      <table class="min-w-full border text-sm">
        <thead class="bg-gray-100 text-gray-700">
          <tr>
            <th class="border px-2 py-1"><input type="checkbox"></th>
            <th class="border px-2 py-1">åºå·</th>
            <th class="border px-2 py-1">ç‰©æ–™å</th>
            <th class="border px-2 py-1">ä¾›åº”å•†</th>
            <th class="border px-2 py-1">å¤‡æ³¨</th>
            <th class="border px-2 py-1">å‡ºæ ·æ—¥</th>
            <th class="border px-2 py-1">æ“ä½œ</th>
          </tr>
        </thead>
        <tbody id="sample-table-body"></tbody>
      </table>
    </div>
  </section>

  <!-- åº”ä»˜æ¿å— -->
  <section id="payment-section" class="max-w-6xl mx-auto bg-white rounded-2xl shadow p-6 mt-8">
    <h2 class="text-2xl font-semibold mb-4">ğŸ’° åº”ä»˜</h2>
    <div class="flex flex-wrap items-center justify-between mb-4 gap-2">
      <div class="flex gap-2">
        <button class="bg-blue-500 text-white px-3 py-1 rounded">æ–°å¢åº”ä»˜</button>
        <button class="bg-red-500 text-white px-3 py-1 rounded">åˆ é™¤é€‰ä¸­</button>
      </div>
      <input type="text" placeholder="æœç´¢ä¾›åº”å•†..." class="border px-3 py-1 rounded w-64">
    </div>
    <div class="overflow-x-auto">
      <table class="min-w-full border text-sm">
        <thead class="bg-gray-100 text-gray-700">
          <tr>
            <th class="border px-2 py-1"><input type="checkbox"></th>
            <th class="border px-2 py-1">åºå·</th>
            <th class="border px-2 py-1">ä¾›åº”å•†</th>
            <th class="border px-2 py-1">å¤‡æ³¨</th>
            <th class="border px-2 py-1">æ“ä½œ</th>
          </tr>
        </thead>
        <tbody id="payment-table-body"></tbody>
      </table>
    </div>
  </section>

  <!-- åº•éƒ¨ç»Ÿè®¡ + å¯¼å‡º -->
  <footer class="max-w-6xl mx-auto mt-10 text-center text-gray-600 pb-10">
    <hr class="my-6">
    <p>ğŸ“Š åˆåŒæ•°ï¼š<span id="contract-count">0</span>ã€€
       ç‰©æ–™æ•°ï¼š<span id="transit-count">0</span>ã€€
       æ‰“æ ·æ•°ï¼š<span id="sample-count">0</span>ã€€
       åº”ä»˜æ•°ï¼š<span id="payment-count">0</span></p>
    <div class="mt-4 flex justify-center gap-4">
      <button class="bg-gray-300 text-gray-800 px-3 py-1 rounded" id="clearAllBtn">æ¸…ç©ºå…¨éƒ¨æ•°æ®</button>
      <button class="bg-green-500 text-white px-3 py-1 rounded" id="exportAllBtn">å¯¼å‡ºå…¨éƒ¨Excel</button>
    </div>
  </footer>

  <script>
    let contractData = JSON.parse(localStorage.getItem('contractData')) || [];
    let transitData  = JSON.parse(localStorage.getItem('transitData')) || [];
    let sampleData   = JSON.parse(localStorage.getItem('sampleData')) || [];
    let paymentData  = JSON.parse(localStorage.getItem('paymentData')) || [];

    function renderTable(sectionId,dataArray){
      const tbody=document.getElementById(sectionId+'-table-body');
      tbody.innerHTML='';
      dataArray.forEach((row,index)=>{
        const tr=document.createElement('tr');
        tr.innerHTML=`
          <td class="border px-2 py-1 text-center"><input type="checkbox"></td>
          <td class="border px-2 py-1 text-center">${index+1}</td>
          ${Object.keys(row).map(key=>`<td class="border px-2 py-1" contenteditable="true">${row[key]}</td>`).join('')}
          <td class="border px-2 py-1 text-center">
            <button class="save-btn bg-green-400 px-1 rounded text-white">ä¿å­˜</button>
            <button class="del-btn bg-red-400 px-1 rounded text-white">åˆ é™¤</button>
          </td>
        `;
        tbody.appendChild(tr);
        tr.querySelector('.save-btn').onclick=()=>{ Object.keys(row).forEach((key,i)=>row[key]=tr.children[i+2].innerText); saveData(sectionId);}
        tr.querySelector('.del-btn').onclick=()=>{ dataArray.splice(index,1); saveData(sectionId); renderAll();}
      });
    }

    function saveData(sectionId){
      if(sectionId==='contract') localStorage.setItem('contractData',JSON.stringify(contractData));
      if(sectionId==='transit')  localStorage.setItem('transitData',JSON.stringify(transitData));
      if(sectionId==='sample')   localStorage.setItem('sampleData',JSON.stringify(sampleData));
      if(sectionId==='payment')  localStorage.setItem('paymentData',JSON.stringify(paymentData));
      updateStats();
    }

    function updateStats(){
      document.getElementById('contract-count').innerText=contractData.length;
      document.getElementById('transit-count').innerText=transitData.length;
      document.getElementById('sample-count').innerText=sampleData.length;
      document.getElementById('payment-count').innerText=paymentData.length;
    }

    function addRow(sectionId){
      let arr, keys;
      if(sectionId==='contract'){ arr=contractData; keys=['ç‰©æ–™å','ä¾›åº”å•†','3æ–¹æ¯”ä»·','å¤‡æ³¨','è¿›å±•']; }
      if(sectionId==='transit') { arr=transitData; keys=['ç‰©æ–™å','ä¾›åº”å•†','å¤‡æ³¨','å‘è´§æ—¥','åˆ°è¾¾æ—¥']; }
      if(sectionId==='sample')  { arr=sampleData; keys=['ç‰©æ–™å','ä¾›åº”å•†','å¤‡æ³¨','å‡ºæ ·æ—¥']; }
      if(sectionId==='payment') { arr=paymentData; keys=['ä¾›åº”å•†','å¤‡æ³¨']; }
      let newRow={}; keys.forEach(k=>newRow[k]=''); arr.push(newRow); saveData(sectionId); renderAll();
    }

    function searchTable(sectionId,input){
      let arr;
      if(sectionId==='contract') arr=contractData;
      if(sectionId==='transit')  arr=transitData;
      if(sectionId==='sample')   arr=sampleData;
      if(sectionId==='payment')  arr=paymentData;
      const tbody=document.getElementById(sectionId+'-table-body');
      Array.from(tbody.children).forEach((tr,index)=>{
        tr.style.display=Object.values(arr[index]).some(v=>v.includes(input.value))?'':'none';
      });
    }

    function clearAll(){
      if(confirm('ç¡®è®¤æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿ')) {
        contractData=[]; transitData=[]; sampleData=[]; paymentData=[];
        saveData('contract'); saveData('transit'); saveData('sample'); saveData('payment'); renderAll();
      }
    }

    function renderAll(){
      renderTable('contract',contractData);
      renderTable('transit',transitData);
      renderTable('sample',sampleData);
      renderTable('payment',paymentData);
    }

    document.querySelectorAll('#contract-section button:first-child')[0].onclick=()=>addRow('contract');
    document.querySelectorAll('#transit-section button:first-child')[0].onclick=()=>addRow('transit');
    document.querySelectorAll('#sample-section button:first-child')[0].onclick=()=>addRow('sample');
    document.querySelectorAll('#payment-section button:first-child')[0].onclick=()=>addRow('payment');

    document.querySelectorAll('#contract-section input')[0].oninput=(e)=>searchTable('contract',e.target);
    document.querySelectorAll('#transit-section input')[0].oninput=(e)=>searchTable('transit',e.target);
    document.querySelectorAll('#sample-section input')[0].oninput=(e)=>searchTable('sample',e.target);
    document.querySelectorAll('#payment-section input')[0].oninput=(e)=>searchTable('payment',e.target);

    document.getElementById('clearAllBtn').onclick=clearAll;

    // å¯¼å‡º Excel
    document.getElementById('exportAllBtn').onclick=()=>{
      const wb=XLSX.utils.book_new();
      wb.Props={Title:'æ¯æ—¥å¾…åŠ',CreatedDate:new Date()};
      wb.SheetNames.push('åˆåŒ');
      wb.SheetNames.push('ç‰©æ–™è·Ÿè¸ª');
      wb.SheetNames.push('æ‰“æ ·');
      wb.SheetNames.push('åº”ä»˜');

      wb.Sheets['åˆåŒ']=XLSX.utils.json_to_sheet(contractData);
      wb.Sheets['ç‰©æ–™è·Ÿè¸ª']=XLSX.utils.json_to_sheet(transitData);
      wb.Sheets['æ‰“æ ·']=XLSX.utils.json_to_sheet(sampleData);
      wb.Sheets['åº”ä»˜']=XLSX.utils.json_to_sheet(paymentData);

      XLSX.writeFile(wb, `æ¯æ—¥å¾…åŠ_${new Date().toLocaleDateString()}.xlsx`);
    }

    renderAll();
  </script>
</body>
</html>
